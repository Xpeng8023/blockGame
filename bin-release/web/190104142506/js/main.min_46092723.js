var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(a,n){function i(e){try{c(o.next(e))}catch(t){n(t)}}function s(e){try{c(o["throw"](e))}catch(t){n(t)}}function c(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,s)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,n&&(i=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,n=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(i=c.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){c.label=r[1];break}if(6===r[0]&&c.label<i[1]){c.label=i[1],i=r;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(r);break}i[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(o){r=[6,o],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var a,n,i,s,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},PostExp=function(e){function t(t,r){var o=e.call(this)||this;return o._url=t,o._params=r,o}return __extends(t,e),t.prototype.send=function(){this.stop(),this.sendPostRequest()},t.prototype.stop=function(){this.request&&(this.request.removeEventListener(egret.Event.COMPLETE,this.onPostComplete,this),this.request.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),this.request.removeEventListener(egret.ProgressEvent.PROGRESS,this.onGetProgress,this),this.request=null)},t.prototype.sendPostRequest=function(){this.request=new egret.HttpRequest,this.request.responseType=egret.HttpResponseType.TEXT,this.request.open(this._url,egret.HttpMethod.POST),this.request.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.request.send(this._params),this.request.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),this.request.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),this.request.addEventListener(egret.ProgressEvent.PROGRESS,this.onGetProgress,this)},t.prototype.onPostComplete=function(e){var t=e.currentTarget;this.response=t.response,this.dispatchEventWith(egret.Event.COMPLETE)},t.prototype.onPostIOError=function(e){console.log("post error : "+e),this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR)},t.prototype.onGetProgress=function(e){},t}(egret.DisplayObjectContainer);__reflect(PostExp.prototype,"PostExp");var Home=function(e){function t(){var t=e.call(this)||this;return t.createGameScene(),t}return __extends(t,e),t.prototype.createGameScene=function(){var e=Tool.createBitmapByName("bg_jpg");this.addChild(e),e.width=Main.stageW,e.height=Main.stageH;var t=new egret.Sprite;this.addChild(t),this.mainBox=t,t.y=Math.round((Main.stageH-1138)/2);for(var r,o=[405,550,695],a=0;16>a;a++)r=Tool.createBitmapByName("home_btn"+(a+1)+"_png"),this.mainBox.addChild(r),Tool.anchorXY(r),r.x=320,r.y=o[a],r.id=a+1,this.addEvent(r)},t.prototype.addEvent=function(e){e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),e.touchEnabled=!0,this.btn=e},t.prototype.onBegin=function(e){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.btn=e.currentTarget,egret.Tween.get(this.btn).to({scaleX:.9,scaleY:.9},100)},t.prototype.onEnd=function(e){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),egret.Tween.get(this.btn).to({scaleX:1,scaleY:1},100)},t.prototype.onTap=function(e){Main.gameId=e.currentTarget.id,EM.dispatch("main").dispatchEventWith("showGame")},t.currentScore=0,t}(egret.DisplayObjectContainer);__reflect(Home.prototype,"Home");var Main=function(e){function t(){var t=e.call(this)||this;return t.class_arr=[Home,Game1,Game1,Game1],t.game_arr=[],t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){t.stageW=this.stage.stageWidth,t.stageH=this.stage.stageHeight,egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return r.sent(),this.stage.removeChild(e),[3,4];case 3:return t=r.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){EM.dispatch("main").addEventListener("showGame",this.showGame,this),EM.dispatch("main").addEventListener("showPause",this.showPause,this),EM.dispatch("main").addEventListener("hidePause",this.hidePause,this),EM.dispatch("main").addEventListener("replay",this.replay,this),this.showGame()},t.prototype.showGame=function(){this.currentGame&&(this.currentGame.touchChildren=!1,egret.Tween.removeTweens(this.currentGame),egret.Tween.get(this.currentGame).to({alpha:0},500).call(Tool.remove,this,[this.currentGame])),this.game_arr[t.gameId]||(this.game_arr[t.gameId]=new this.class_arr[t.gameId]),this.currentGame=this.game_arr[t.gameId],this.addChild(this.currentGame),this.currentGame.touchChildren=!0,egret.Tween.removeTweens(this.currentGame),this.currentGame.alpha=0,egret.Tween.get(this.currentGame).to({alpha:1},200,egret.Ease.quadOut)},t.prototype.showPause=function(){this.pause=Pause.instance,this.stage.addChild(this.pause),this.pause.alpha=0,this.pause.touchChildren=!0,egret.Tween.removeTweens(this.pause),egret.Tween.get(this.pause).to({alpha:1},300,egret.Ease.quadOut)},t.prototype.hidePause=function(){this.pause&&(this.pause.touchChildren=!1,egret.Tween.removeTweens(this.pause),egret.Tween.get(this.pause).to({alpha:0},300).call(Tool.remove,this,[this.pause]))},t.prototype.replay=function(){0!=t.gameId&&this.currentGame.replay()},t.stageW=0,t.stageH=0,t.gameId=0,t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Pause=function(e){function t(){var t=e.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.createGameScene,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.createGameScene=function(){var e=Tool.createSprite(0,[Main.stageW,Main.stageH]);this.addChild(e),e.touchEnabled=!0,e.alpha=.85;var t=new egret.Sprite;this.addChild(t),this.mainBox=t,t.y=Math.round((Main.stageH-1138)/2);var r=Tool.createBitmapByName("btn_play_png");t.addChild(r),Tool.anchorXY(r),r.x=320,r.y=428,r.name="play",r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var o=Tool.createBitmapByName("btn_home_png");t.addChild(o),Tool.anchorXY(o),o.x=224,o.y=568,o.name="home",o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var a=Tool.createBitmapByName("btn_replay_png");t.addChild(a),Tool.anchorXY(a),a.x=404,a.y=568,a.name="replay",a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},t.prototype.onTap=function(e){"play"==e.currentTarget.name||("home"==e.currentTarget.name?(Main.gameId=0,EM.dispatch("main").dispatchEventWith("showGame")):"replay"==e.currentTarget.name&&EM.dispatch("main").dispatchEventWith("replay")),EM.dispatch("main").dispatchEventWith("hidePause")},t}(egret.DisplayObjectContainer);__reflect(Pause.prototype,"Pause");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var EM=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.dispatch=function(e){return void 0===e&&(e=null),null!=e?(t.dispatchDict[e]||(t.dispatchDict[e]=new egret.EventDispatcher),t.dispatchDict[e]):(null==t._dispatch&&(t._dispatch=new egret.EventDispatcher),t._dispatch)},t.removeDispatch=function(e){null!=t.dispatchDict&&(null==t.dispatchDict[e]&&t.removeEvent(t.dispatchDict[e]),delete t.dispatchDict[e])},t.addEvent=function(e,r,o,a){t.eventDict[e.hashCode]||(t.eventDict[e.hashCode]={}),t.eventDict[e.hashCode][r]&&e.removeEventListener(r,t.eventDict[e.hashCode][r].listener,t.eventDict[e.hashCode][r].thisObject),t.eventDict[e.hashCode][r]={dispatch:e,type:r,listener:o,thisObject:a},e.addEventListener(r,o,a)},t.removeEvent=function(e,r){if(void 0===r&&(r=null),t.eventDict[e.hashCode]){var o;if(null==r){for(var a in t.eventDict[e.hashCode])o=t.eventDict[e.hashCode][a],e.removeEventListener(o.type,o.listener,o.thisObject);delete t.eventDict[e.hashCode]}else o=t.eventDict[e.hashCode][r],e.removeEventListener(o.type,o.listener,o.thisObject),delete t.eventDict[e.hashCode][r]}},t.dispatchDict={},t.eventDict={},t}(egret.EventDispatcher);__reflect(EM.prototype,"EM");var Events=function(e){function t(t,r,o,a){void 0===r&&(r=""),void 0===o&&(o=!1),void 0===a&&(a=!1);var n=e.call(this,t,o,a)||this;return n._resName="",n._resName=r,n}return __extends(t,e),Object.defineProperty(t.prototype,"resName",{get:function(){return this._resName},enumerable:!0,configurable:!0}),t.LOAD_COMPLETE="loadComplte",t.SHOW_PAGE="showPage",t}(egret.Event);__reflect(Events.prototype,"Events");var GetExp=function(e){function t(t,r){var o=e.call(this)||this,a=t.split("?");return o._url=a[0],o._params=r+(a[1]?"&"+a[1]:""),o}return __extends(t,e),t.prototype.reSend=function(){this.stop(),this.send()},t.prototype.stop=function(){this.request&&(this.request.removeEventListener(egret.Event.COMPLETE,this.onGetComplete,this),this.request.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this),this.request.removeEventListener(egret.ProgressEvent.PROGRESS,this.onGetProgress,this),this.request=null)},t.prototype.send=function(){var e=new egret.HttpRequest;e.responseType=egret.HttpResponseType.TEXT,e.withCredentials=!0,e.open(this._url,egret.HttpMethod.GET),e.send(),e.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this),e.addEventListener(egret.ProgressEvent.PROGRESS,this.onGetProgress,this)},t.prototype.onGetComplete=function(e){var t=e.currentTarget;this.response=t.response,this.dispatchEventWith("complete")},t.prototype.onGetIOError=function(e){console.log("get error : "+e),this.dispatchEventWith("io_error")},t.prototype.onGetProgress=function(e){},t}(egret.DisplayObjectContainer);__reflect(GetExp.prototype,"GetExp");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.createView,t),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=.45*this.stage.stageHeight,this.textField.width=this.stage.stageWidth,this.textField.height=100,this.textField.textAlign="center",this.textField.size=26},t.prototype.onProgress=function(e,t){this.textField.text="loading:"+String(Math.floor(e/t))+"%"},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Meteor=function(e){function t(t){var r=e.call(this)||this;r.textureName=t;var o=Tool.createBitmapByName(r.textureName);return Tool.anchorXY(o),o.x=o.width,o.y=o.height,r.addChild(o),r.loop(o),r}return __extends(t,e),t.produce=function(e){var r=e;null==t.cacheDict[r]&&(t.cacheDict[r]=[]);var o,a=t.cacheDict[r];return o=a.length>0?a.pop():new t(r)},t.reclaim=function(e){null==t.cacheDict[e.textureName]&&(t.cacheDict[e.textureName]=[]);var r=t.cacheDict[e.textureName];-1==r.indexOf(e)&&r.push(e),Tool.remove(e)},t.prototype.loop=function(e){var t,r,o;r=600*Math.random()-300,o=-100>r?700*Math.random():-e.height,e.x=r,e.y=o,e.scaleX=e.scaleY=.5+.5*Math.random(),e.alpha=1-(1-e.scaleX)/.5*.5,t=egret.Tween.get(e),t.wait(1500*Math.random()+500).to({x:r+1e3,y:o+1e3*Math.tan(Math.PI/180*40)},4e3/e.scaleX).call(this.loop,this,[e])},t.cacheDict={},t}(egret.Sprite);__reflect(Meteor.prototype,"Meteor");var DictBitmap=function(){function e(){}return e.produce=function(t){var r=t;null==e.cacheDict[r]&&(e.cacheDict[r]=[]);var o,a=e.cacheDict[r];return a.length>0?o=a.pop():(o=new egret.Bitmap(RES.getRes(r)),o.textureName=r),o},e.reclaim=function(t,r){void 0===r&&(r=!0),null==e.cacheDict[t.textureName]&&(e.cacheDict[t.textureName]=[]);var o=e.cacheDict[t.textureName];-1==o.indexOf(t)&&o.push(t),t.parent&&t.parent.removeChild(t),t&&r&&(t.x=0,t.y=0,t.scaleX=t.scaleY=1,t.rotation=0,t.alpha=1,egret.Tween.removeTweens(t))},e.cacheDict={},e}();__reflect(DictBitmap.prototype,"DictBitmap");var SpriteDict=function(){function e(){}return e.produce=function(t){var r=t;null==e.cacheDict[r]&&(e.cacheDict[r]=[]);var o,a=e.cacheDict[r];return o=a.length>0?a.pop():null},e.reclaim=function(t,r){void 0===r&&(r=!0),null==e.cacheDict[t.id]&&(e.cacheDict[t.id]=[]);var o=e.cacheDict[t.id];-1==o.indexOf(t)&&o.push(t),t.parent&&t.parent.removeChild(t),t&&r&&(t.x=0,t.y=0,t.scaleX=t.scaleY=1,t.rotation=0,t.alpha=1,egret.Tween.removeTweens(t))},e.cacheDict={},e}();__reflect(SpriteDict.prototype,"SpriteDict");var EFT=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.fadeIn=function(e,t,r,o){void 0===t&&(t=0),void 0===r&&(r=[0,300]),void 0===o&&(o=1200),e.x+=r[0],e.y+=r[1],e.alpha=0,egret.Tween.get(e).wait(t).to({x:e.x-r[0],y:e.y-r[1],alpha:1},o,egret.Ease.quartOut)},t.typewrite=function(e,t,r){void 0===r&&(r=40);var o=new egret.Sprite;o.graphics.beginFill(16711680),o.graphics.drawRect(0,0,e.width,e.height),o.graphics.endFill(),e.parent.addChild(o),e.mask=o,o.x=e.x,o.y=e.y,o.scaleX=0,o.scaleY=0;var a="";t[1][0]-t[0][0]!=0?a+="x":o.scaleX=1,t[1][1]-t[0][1]!=0?a+="y":o.scaleY=1,egret.Tween.get(o).wait(r).call(function(){},this);var n=new egret.Timer(r,t.length);n.addEventListener(egret.TimerEvent.TIMER,function(r){var i=n.currentCount-1;"x"==a?o.scaleX=t[i][0]/e.width:"y"==a?o.scaleY=t[i][1]/e.height:(o.scaleX=t[i][0]/e.width,o.scaleY=t[i][1]/e.height)},this),n.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(t){e.mask=null,o.parent.removeChild(o),e.dispatchEventWith("complete")},this),n.start()},t.shake=function(e,t,r,o,a){void 0===t&&(t=70),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=!0);var n=t*o,i=r*o;e.__mcX=e.x,e.__mcY=e.y;var s;s=1==a?egret.Tween.get(e,{loop:!0}):egret.Tween.get(e),s.to({x:e.__mcX+i,y:e.__mcY,alpha:1},n).to({x:e.__mcX-i,y:e.__mcY-i,alpha:1},n).to({x:e.__mcX,y:e.__mcY-i,alpha:1},n).to({x:e.__mcX,y:e.__mcY+i,alpha:1},n).to({x:e.__mcX-i,y:e.__mcY,alpha:1},n)},t.FormatData=function(e,t){void 0===t&&(t=1);for(var r,o=[],a=[],n=0;n<e.length;n++){o=[],r=e[n];for(var i=0;i<r.width;i+=t)for(var s=0;s<r.height;s+=t)r.texture.getPixels(i,s,t,t)[3]>127.5&&o.push([i,s]);a.push(o)}return a},t}(egret.EventDispatcher);__reflect(EFT.prototype,"EFT");var Tool=function(){function e(){}return e.gear=function(e,t){return void 0===t&&(t=1),e*t},e.hitTest=function(e,t){var r=e.getBounds(),o=t.getBounds();return r.x=e.x,r.y=e.y,o.x=t.x,o.y=t.y,r.intersects(o)},e.hitTest2=function(e,t,r,o,a,n,i,s){return e>=a&&e>=a+i?!1:a>=e&&a>=e+r?!1:t>=n&&t>=n+s?!1:n>=t&&n>=t+o?!1:!0},e.remove=function(e){e?e.parent&&e.parent.removeChild(e):console.log("Tool.remove:对象为空")},e.anchorXY=function(e,t,r){var o=t||0==t?t:Math.round(e.width/2),a=r||0==r?r:Math.round(e.height/2);e.anchorOffsetX=o,e.anchorOffsetY=a},e.createBitmapByName=function(t,r){void 0===r&&(r={});var o=new egret.Bitmap,a=RES.getRes(t);return o.texture=a,(r.x||0==r.x)&&(o.x=r.x),(r.y||0==r.y)&&(o.y=r.y),r.anchor&&e.anchorXY(o),r.scaleX&&(o.scaleX=r.scaleX),r.scaleY&&(o.scaleY=r.scaleY),r.scale&&(o.scaleX=o.scaleY=r.scale),o},e.createSprite=function(e,t){void 0===t&&(t=[640,1030]);var r=new egret.Sprite;return r.graphics.beginFill(e),r.graphics.drawRect(0,0,t[0],t[1]),r.graphics.endFill(),r},e.getRandom=function(e,t,r){void 0===r&&(r=2);var o=Math.random()*(t-e)+e;return o=Math.floor(o*Math.pow(10,r))/Math.pow(10,r)},e.RandomString=function(e){for(var t="";t.length<e;t+=Math.random().toString(36).substr(2));return t.substr(0,e)},e.getMcData=function(e,t){e=RES.getRes(e),t=RES.getRes(t);var r=new egret.MovieClipDataFactory(e,t);return r},e.alignObj=function(e,t,r,o,a,n,i){void 0===n&&(n=0),void 0===i&&(i=0),e.x=Math.round((o-t)/2)+n,e.y=Math.round((a-r)/2)+i},e.scaleObj=function(t,r,o,a,n,i,s){void 0===i&&(i="out"),void 0===s&&(s=!0);var c=1;c="out"==i?r/o>a/n?n/o:a/r:r/o>a/n?r/a:o/n,t.scaleX=t.scaleY=c,s&&e.alignObj(t,r*c,o*c,a,n)},e}();__reflect(Tool.prototype,"Tool");var Game1=function(e){function t(){var t=e.call(this)||this;return t.isGameOver=!1,t.cloNum=10,t.rowNum=10,t.blockStartX=61,t.blockStartY=330,t.blockW=50,t.blockSpace=t.blockW+2,t.blockGroupArr=[[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],[[1,1,1],[1,1,1],[1,1,1]],[[1,1],[1,1]],[[1]],[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,1,1,1]],[[1,0,0],[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[0,0,1],[1,1,1]],[[1,0,0],[1,0,0],[1,1,1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[1,0],[1,1]],[[1,1,1,1]],[[1,1,1]],[[1,1]]],t.cacheDict={},t.createGameScene(),t}return __extends(t,e),Object.defineProperty(t,"topScore",{get:function(){var e=localStorage.getItem("game1-topScore");return e||(e="0",localStorage.setItem("game1-topScore","0")),e},set:function(e){localStorage.setItem("game1-topScore",e)},enumerable:!0,configurable:!0}),t.prototype.createGameScene=function(){var e=this,r=Tool.createBitmapByName("bg_jpg");this.addChild(r),r.width=Main.stageW,r.height=Main.stageH;var o=Tool.createBitmapByName("btn_pause_png");this.addChild(o),Tool.anchorXY(o),o.x=65,o.y=65,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){EM.dispatch("main").dispatchEventWith("showPause")},this);for(var a=0;5>a;a++)setTimeout(function(){var t=new Meteor("meteor_png");t.alpha=.5,e.addChild(t)},800*a);var n=new egret.Sprite;this.addChild(n),this.mainBox=n,n.y=Math.round((Main.stageH-1138)/2);var i=Tool.createBitmapByName("icon_png");n.addChild(i),Tool.anchorXY(i),i.x=320,i.y=118,this.score_icon=i;var s=RES.getRes("score_num_fnt"),c=new egret.BitmapText;c.font=s,n.addChild(c),c.x=320,c.y=105,c.text="0",this.score_txt=c,this.score_icon.x=320-Math.round(32*this.score_txt.text.length/2),this.score_txt.x=this.score_icon.x+35,this.score_top_txt=new egret.TextField,n.addChild(this.score_top_txt),this.score_top_txt.size=24,this.score_top_txt.width=640,this.score_top_txt.y=170,this.score_top_txt.textAlign="center",this.score_top_txt.text="最高分数："+t.topScore;var h=Tool.createBitmapByName("border_png");n.addChild(h),Tool.anchorXY(h),h.x=320,h.y=590;var l=Tool.createBitmapByName("btn_reflush_png");n.addChild(l),Tool.anchorXY(l),l.x=164,l.y=260,l.name="reflush",this.addPropEvent(l);var u=Tool.createBitmapByName("btn_add_png");n.addChild(u),Tool.anchorXY(u),u.x=320,u.y=260,u.name="add",this.addPropEvent(u);var d=Tool.createBitmapByName("btn_hammer_png");n.addChild(d),Tool.anchorXY(d),d.x=474,d.y=260,d.name="hammer",this.addPropEvent(d),this.blockData=[];for(var a=0;a<this.cloNum;a++){this.blockData[a]=[];for(var p=0;p<this.rowNum;p++)this.blockData[a][p]=0}this.blockArray=[];for(var a=0;a<this.cloNum;a++)this.blockArray[a]=[];this.createPreBlocks()},t.prototype.rotationBlockGroup=function(e,t){var r=[0,1,2,3];if(void 0!=t)var o=t;else var o=r[Tool.getRandom(0,4,0)];for(var a=[].concat(e),n=0;o>n;n++){a=[];for(var i=0;i<e[0].length;i++)a[i]=[];for(var i=0;i<e.length;i++)for(var s=0;s<e[i].length;s++)a[s][e.length-i-1]=e[i][s];e=[].concat(a)}return a},t.prototype.getBlockGroup=function(){var e=this.blockGroupArr[Tool.getRandom(0,this.blockGroupArr.length,0)],t=this.rotationBlockGroup(e);return t},t.prototype.createPreBlocks=function(){this.preBlockArr=[];for(var e,t,r,o,a=175,n=85,i=910,s=0;3>s;s++){e=new egret.Sprite,this.mainBox.addChild(e),this.preBlockArr.push(e),r=this.getBlockGroup(),o=[];for(var c=Tool.getRandom(1,8,0),h=0;h<r.length;h++){e.groupArr=[],o[h]=[];for(var l=0;l<r[0].length;l++)1==r[h][l]&&(t=DictBitmap.produce("common_block_"+c+"_png"),e.addChild(t),t.colorId=c,t.scaleX=t.scaleY=1,Tool.anchorXY(t),t.x=this.blockSpace*l+t.anchorOffsetX,t.y=this.blockSpace*h+t.anchorOffsetY,o[h][l]=t)}e.groupData=r,e.groupArr=o,Tool.anchorXY(e);var u=Math.round((4*this.blockSpace*.6-e.width)/2),d=Math.round((4*this.blockSpace*.6-e.height)/2);e.scaleX=e.scaleY=e.mcS=.6,e.x=e.mcX=e.beginX=n+s*a+e.anchorOffsetX+u,e.y=e.mcY=e.beginY=i+e.anchorOffsetY+d,this.addEvent(e),e.y+=500,egret.Tween.get(e).wait(100*s).to({y:e.mcY},600,egret.Ease.quartOut);var p=Tool.createSprite(16711680,[4*this.blockSpace,4*this.blockSpace]);p.x=Math.round((e.width-p.width)/2),p.y=Math.round((e.height-p.height)/2),e.addChild(p),p.alpha=0}},t.prototype.releaseBlockGroup=function(e){var r=e.groupData,o=e.x-e.anchorOffsetX,a=e.y-e.anchorOffsetY,n=Math.round((a-this.blockStartY)/this.blockSpace),i=Math.round((o-this.blockStartX)/this.blockSpace),s=r.length,c=r[0].length,h=this.checkCanPush(r,n,i);if(h){for(var l,u=0,d=0;s>d;d++)for(var p=0;c>p;p++)1==r[d][p]&&(l=e.groupArr[d][p],this.blockData[d+n][p+i]=1,this.blockArray[d+n][p+i]=l,this.mainBox.addChild(l),l.x=this.blockStartX+(p+i)*this.blockSpace+l.anchorOffsetX,l.y=this.blockStartY+(d+n)*this.blockSpace+l.anchorOffsetY,this.addPushEft(l),u++);t.currentScore+=u,egret.Tween.get(this).to({score:t.currentScore},300),this.preBlockArr.splice(this.preBlockArr.indexOf(e),1),Tool.remove(e),e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.checkBlockData(),0==this.preBlockArr.length&&this.createPreBlocks(),this.checkGameOver()}else egret.Tween.removeTweens(e),egret.Tween.get(e).to({x:e.mcX,y:e.mcY,scaleX:.6,scaleY:.6},300,egret.Ease.quadInOut)},t.prototype.checkGameOver=function(){for(var e,t=!1,r=0;r<this.preBlockArr.length&&(e=this.preBlockArr[r],!(t=this.checkCanInit(e.groupData)));r++);t||(this.isGameOver=!0,this.showGameOver(),console.log("游戏结束"))},t.prototype.checkCanPush=function(e,t,r){var o=e.length,a=e[0].length,n=t+o,i=r+a;if(0>t||0>r||n>this.cloNum||i>this.rowNum)return!1;for(var s=!1,c=0;o>c;c++){for(var h=0;a>h;h++)if(1==e[c][h]&&1==this.blockData[c+t][h+r]){s=!0;break}if(s)break}for(var s=!1,c=0;o>c;c++){for(var h=0;a>h;h++)if(1==e[c][h]&&1==this.blockData[c+t][h+r]){s=!0;break}if(s)break}return s?!1:!0},t.prototype.checkBlockData=function(){for(var e,r=[],o=[],a=0;a<this.cloNum;a++)-1==this.blockData[a].indexOf(0)&&r.push(a);for(var n=this.rotationBlockGroup(this.blockData,1),a=0;a<n.length;a++)-1==n[a].indexOf(0)&&o.push(a);for(var i=0,s=10,c=!1,a=0;a<this.cloNum;a++){c=!1;for(var h=0;h<this.rowNum;h++)-1!=r.indexOf(a)&&0!=this.blockData[a][h]&&(e=this.blockArray[a][h],egret.Tween.get(e).wait(20*h).to({scaleX:0,scaleY:0},150,egret.Ease.quadOut).call(function(e){DictBitmap.reclaim(e)},this,[e]),this.blockData[a][h]=0,this.blockArray[a][h]="",this.addClearEft(e),c||(c=!0,i+=s,s+=10))}for(var l,a=0;a<o.length;a++){l=o[a];for(var h=0;h<this.cloNum;h++)e=this.blockArray[h][l],egret.Tween.get(e).wait(20*h).to({scaleX:0,scaleY:0},150,egret.Ease.quadOut).call(function(e){DictBitmap.reclaim(e)},this,[e]),this.blockData[h][l]=0,this.blockArray[h][l]="",this.addClearEft(e);i+=s,s+=10}t.currentScore+=i,egret.Tween.get(this).to({score:t.currentScore},500)},t.prototype.addClearEft=function(e){for(var t,r=0;10>r;r++)t=DictBitmap.produce("star"+e.colorId+"_"+Tool.getRandom(1,3,0)+"_png"),this.mainBox.addChild(t),t.blendMode=egret.BlendMode.ADD,Tool.anchorXY(t),t.x=e.x+Tool.getRandom(-10,10),t.y=e.y+Tool.getRandom(-10,10),t.scaleX=t.scaleY=1,egret.Tween.get(t).to({x:t.x+Tool.getRandom(-100,100),y:t.y+Tool.getRandom(-100,100),scaleX:0,scaleY:0},300+Tool.getRandom(0,800),egret.Ease.quadOut).call(function(e){DictBitmap.reclaim(e)},this,[t])},t.prototype.addPushEft=function(e){for(var t,r=6,o=0;4>o;o++)for(var a=0;r>a;a++)t=DictBitmap.produce("star"+e.colorId+"_"+Tool.getRandom(1,3,0)+"_png"),this.mainBox.addChild(t),t.blendMode=egret.BlendMode.ADD,Tool.anchorXY(t),0==o?(t.x=e.x-e.anchorOffsetX+a*e.width/r,t.y=e.y-e.anchorOffsetY):1==o?(t.x=e.x+e.anchorOffsetX,t.y=e.y-e.anchorOffsetY+a*e.height/r):2==o?(t.x=e.x-e.anchorOffsetX+a*e.height/r,t.y=e.y+e.anchorOffsetY):3==o&&(t.x=e.x-e.anchorOffsetX,t.y=e.y-e.anchorOffsetX+a*e.height/r),t.scaleX=t.scaleY=Tool.getRandom(.2,.5),egret.Tween.get(t).to({x:t.x+Tool.getRandom(-15,15),y:t.y+Tool.getRandom(-15,15),scaleX:0,scaleY:0},300+Tool.getRandom(0,500),egret.Ease.quadOut).call(function(e){DictBitmap.reclaim(e)},this,[t])},Object.defineProperty(t.prototype,"score",{get:function(){return Number(this.score_txt.text)},set:function(e){var t="";this.score_txt.text=t+String(Math.floor(e)),this.score_icon.x=320-Math.round(32*this.score_txt.text.length/2),this.score_txt.x=this.score_icon.x+35},enumerable:!0,configurable:!0}),t.prototype.checkCanInit=function(e){for(var t=!1,r=0;r<=this.blockData.length-e.length;r++){for(var o=0;o<=this.blockData[r].length-e[0].length;o++)if(this.checkCanPush(e,r,o)){t=!0;break}if(t)break}return t},t.prototype.addEvent=function(e){e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this)},t.prototype.touchBegin=function(e){this.currentBox=e.currentTarget,this.currentBox.beginX=this.currentBox.x,this.currentBox.beginY=this.currentBox.y,this.mainBox.addChild(this.currentBox),this.currentBox.x=e.stageX,this.currentBox.y=e.stageY-Math.round(this.currentBox.height/2)-20,egret.Tween.removeTweens(this.currentBox),egret.Tween.get(this.currentBox).to({scaleX:1,scaleY:1},300,egret.Ease.quadOut),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.touchBeginX=e.stageX,this.touchBeginY=e.stageY},t.prototype.touchMove=function(e){this.currentBox.x=e.stageX,this.currentBox.y=e.stageY-Math.round(this.currentBox.height/2)-30},t.prototype.touchEnd=function(e){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.releaseBlockGroup(this.currentBox)},t.prototype.showGameOver=function(){Number(t.topScore)<t.currentScore&&(t.topScore=String(t.currentScore)),this.stage.addChild(GameOver1.instance),egret.Tween.removeTweens(GameOver1.instance),GameOver1.instance.updata(),GameOver1.instance.alpha=0,egret.Tween.get(GameOver1.instance).to({alpha:1},500,egret.Ease.quadOut),GameOver1.instance.addEventListener("replay",this.replay,this)},t.prototype.replay=function(){this.hideGameOver(),this.score_top_txt.text="最高分数："+t.topScore,t.currentScore=0,egret.Tween.get(this).to({score:t.currentScore},500);for(var e,r=0;r<this.preBlockArr.length;r++)e=this.preBlockArr[r],Tool.remove(e);this.preBlockArr=[],this.blockData=[];for(var r=0;r<this.cloNum;r++){this.blockData[r]=[];for(var o=0;o<this.rowNum;o++)this.blockData[r][o]=0}for(var a,r=0;r<this.blockArray.length;r++)for(var o=0;o<this.rowNum;o++)a=this.blockArray[r][o],a&&egret.Tween.get(a).to({scaleX:0,scaleY:0},150,egret.Ease.quadOut).call(function(e){DictBitmap.reclaim(e)},this,[a]);this.blockArray=[];for(var r=0;r<this.cloNum;r++)this.blockArray[r]=[];this.createPreBlocks()},t.prototype.hideGameOver=function(){egret.Tween.removeTweens(GameOver1.instance),egret.Tween.get(GameOver1.instance).to({alpha:0},300,egret.Ease.quadOut).call(Tool.remove,this,[GameOver1.instance])},t.prototype.addPropEvent=function(e){e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPropTap,this)},t.prototype.onPropTap=function(e){"reflush"==e.currentTarget.name?this.reflush():"add"==e.currentTarget.name?this.add():"hammer"==e.currentTarget.name&&this.hammer()},t.prototype.reflush=function(){for(var e,t,r,o=0;o<this.preBlockArr.length;o++){r=this.preBlockArr[o],e=r.groupData;for(var a=0;a<e.length;a++)for(var n=0;n<e[0].length;n++)1==e[a][n]&&(t=r.groupArr[a][n],DictBitmap.reclaim(t));Tool.remove(r)}this.preBlockArr=[],this.createPreBlocks(),this.checkGameOver()},t.prototype.add=function(){this.addHit||(this.addHit=Tool.createBitmapByName("cover_png"),this.addHit.x=this.mainBox.x,this.addHit.y=this.mainBox.y,this.addHit.touchEnabled=!0,this.addHit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addBlock,this)),this.addChild(this.addHit)},t.prototype.addBlock=function(e){Tool.remove(this.addHit);var r=Math.floor((e.stageY-this.mainBox.y-this.blockStartY)/this.blockSpace),o=Math.floor((e.stageX-this.mainBox.x-this.blockStartX)/this.blockSpace);if(!(0>r||0>o||r>this.cloNum||o>this.rowNum)&&0==this.blockData[r][o]){var a=Tool.getRandom(1,8,0),n=DictBitmap.produce("common_block_"+a+"_png");this.mainBox.addChild(n),n.colorId=a,Tool.anchorXY(n),n.x=this.blockStartX+o*this.blockSpace+n.anchorOffsetX,n.y=this.blockStartY+r*this.blockSpace+n.anchorOffsetY,this.blockArray[r][o]=n,this.blockData[r][o]=1,this.addPushEft(n),t.currentScore+=1,egret.Tween.get(this).to({score:t.currentScore},300),this.checkBlockData()}},t.prototype.hammer=function(){this.hammerHit||(this.hammerHit=Tool.createBitmapByName("cover_png"),this.hammerHit.x=this.mainBox.x,this.hammerHit.y=this.mainBox.y,this.hammerHit.touchEnabled=!0,this.hammerHit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hammerBlock,this)),this.addChild(this.hammerHit)},t.prototype.hammerBlock=function(e){Tool.remove(this.hammerHit);var t=Math.floor((e.stageY-this.mainBox.y-this.blockStartY)/this.blockSpace),r=Math.floor((e.stageX-this.mainBox.x-this.blockStartX)/this.blockSpace);if(!(0>t||0>r||t>this.cloNum||r>this.rowNum)&&1==this.blockData[t][r]){this.blockData[t][r]=0;var o=this.blockArray[t][r];this.blockArray[t][r]=void 0,this.addClearEft(o),DictBitmap.reclaim(o)}},t.currentScore=0,t}(egret.DisplayObjectContainer);__reflect(Game1.prototype,"Game1");var GameOver1=function(e){function t(){var t=e.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.createGameScene,t),t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.createGameScene=function(){var e=Tool.createSprite(0,[Main.stageW,Main.stageH]);this.addChild(e),e.touchEnabled=!0,e.alpha=.7;var t=new egret.Sprite;this.addChild(t),this.mainBox=t,t.y=Math.round((Main.stageH-1138)/2);var r=Tool.createBitmapByName("gameover_txt_png");t.addChild(r),Tool.anchorXY(r),r.x=320,r.y=440;var o=new egret.Sprite;this.mainBox.addChild(o);var a=Tool.createBitmapByName("icon_png");o.addChild(a);var n=RES.getRes("score_num_fnt"),i=new egret.BitmapText;i.font=n,o.addChild(i),i.x=50,i.y=7,i.text=String(Game1.currentScore),this.score_txt=i,o.x=Math.round((640-o.width)/2),o.y=550;var s=Tool.createBitmapByName("btn_replay_png");t.addChild(s),Tool.anchorXY(s),s.x=320,s.y=660,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchEnd,this)
},t.prototype.updata=function(){this.score_txt.text=String(Game1.currentScore)},t.prototype.touchEnd=function(e){this.dispatchEventWith("replay")},t}(egret.DisplayObjectContainer);__reflect(GameOver1.prototype,"GameOver1");